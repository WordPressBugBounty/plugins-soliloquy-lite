jQuery(document).ready(function(i){i("a.soliloquy-media-library").on("click",function(e){e.preventDefault(),wp.media.frames.soliloquy?wp.media.frames.soliloquy.open():(wp.media.frames.soliloquy=new wp.media.view.MediaFrame.Post({title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0,library:{type:"image"}}),wp.media.frames.soliloquy.on("open",function(){var t=wp.media.frames.soliloquy.state().get("selection");i("ul#soliloquy-output li").each(function(){var e=wp.media.attachment(i(this).attr("id"));t.add(e?[e]:[])})}),wp.media.frames.soliloquy.on("ready",function(){}),wp.media.frames.soliloquy.on("insert",function(e){var l=wp.media.frames.soliloquy.state(),o=[];e.each(function(e){var t=l.display(e).toJSON(),i=e.get("type");switch(t.link){case"none":e.set("link","");break;case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",t.linkUrl)}"image"===i&&o.push(e.toJSON())},this),i.post(soliloquy_metabox_local.ajax,{action:"soliloquy_insert_slides",nonce:soliloquy_metabox_local.insert_nonce,post_id:soliloquy_metabox_local.id,images:JSON.stringify(o)},function(e){e&&(i("#soliloquy-output").html(e.data),SoliloquySlidesUpdate(),e=i("#soliloquy-output li").length,i(".soliloquy-count").text(e.toString()),0<e&&(i("#soliloquy-empty-slider").fadeOut().addClass("soliloquy-hidden"),i(".soliloquy-slide-header").removeClass("soliloquy-hidden").fadeIn(),i(".soliloquy-bulk-actions").fadeOut()))},"json")}),wp.media.frames.soliloquy.open(),i("div.media-menu a.media-menu-item:nth-child(2)").addClass("hidden"),i("div.media-menu a.media-menu-item:nth-child(3)").addClass("hidden"),i("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"),i("div.media-menu a.media-menu-item:nth-child(6)").addClass("hidden"))})}),jQuery(document).ready(function(i){i("a.soliloquy-slides-delete").click(function(e){if(e.preventDefault(),!confirm(soliloquy_metabox_local.remove_multiple))return!1;var t=[],e=(i("ul#soliloquy-output > li.selected").each(function(){t.push(i(this).attr("id"))}),{action:"soliloquy_remove_slides",attachment_ids:t,post_id:soliloquy_metabox_local.id,nonce:soliloquy_metabox_local.remove_nonce});i.post(soliloquy_metabox_local.ajax,e,function(e){i("ul#soliloquy-output > li.selected").remove(),i(".soliloquy-bulk-actions").fadeOut(),i(".soliloquy-select-all").prop("checked",!1),i(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click"),SoliloquySlidesUpdate(!1);var t=i("#soliloquy-output li").length;i(".soliloquy-count").text(t.toString()),0===t&&(i(".soliloquy-bulk-actions").fadeOut(),i(".soliloquy-slide-header").fadeOut().addClass("soliloquy-hidden"),i("#soliloquy-empty-slider").removeClass("soliloquy-hidden").fadeIn())},"json")}),i("#soliloquy-settings-content ").on("click",".soliloquy-remove-slide",function(e){var t;e.preventDefault(),confirm(soliloquy_metabox_local.remove)&&(e={action:"soliloquy_remove_slide",attachment_id:t=i(this).parent().attr("id"),post_id:soliloquy_metabox_local.id,nonce:soliloquy_metabox_local.remove_nonce},i.post(soliloquy_metabox_local.ajax,e,function(e){i("#"+t).fadeOut("normal",function(){i(this).remove(),i(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click"),SoliloquySlidesUpdate(!1);var e=i("#soliloquy-output li").length;i(".soliloquy-count").text(e.toString()),0===e&&(i(".soliloquy-bulk-actions").fadeOut(),i(".soliloquy-slide-header").fadeOut().addClass("soliloquy-hidden"),i("#soliloquy-empty-slider").removeClass("soliloquy-hidden").fadeIn())})},"json"))})});var SoliloquySlide=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:"",type:""}}),SoliloquySlides=new Backbone.Collection,SoliloquyModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}}),SoliloquyView=wp.Backbone.View.extend({id:"soliloquy-meta-edit",tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("soliloquy-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","keyup .CodeMirror":"updateCode","blur textarea":"updateItem","change select":"updateItem","click a.soliloquy-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click a.soliloquy-thumbnail":"insertThumb","click a.soliloquy-thumbnail-delete":"removeThumb","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var t=0;this.collection.each(function(e){if(String(e.get("id"))==String(this.attachment_id))return this.model=e,this.attachment_index=t,!1;t++},this)},updateCode:function(e){$model=this.model,$textarea=this.$el.find(".soliloquy-html-slide-code"),$model.set("code",this.editor.getValue(),{silent:!0}),$textarea.text()},insertThumb:function(e){$model=this.model,e.preventDefault();this.$el.data("field");var t=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox_local.videoframe,library:{type:"image"},button:{text:soliloquy_metabox_local.videouse}});t.on("select",function(){var e=t.state().get("selection").first().toJSON();$model.set("src",e.url,{silent:!0}),jQuery("div.thumbnail > img",$parent.find(".media-frame-content")).attr("src",e.url)}),t.open()},removeThumb:function(e){e.preventDefault(),$model=this.model,$parent=this.$el.parent(),jQuery("div.thumbnail > img",$parent.find(".media-frame-content")).attr("src",""),$model.set("src","",{silent:!0})},render:function(){return this.$el.html(this.template(this.model.attributes)),0<this.child_views.length&&this.child_views.forEach(function(e){e=new e({model:this.model});this.$el.find("div.addons").append(e.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0===this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),(textarea=this.$el.find(".soliloquy-html-slide-code")).length&&(this.editor=CodeMirror.fromTextArea(textarea[0],{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"ttcn"})),this.$el.trigger("soliloquyRenderMeta"),this},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&alert(e)},loadPreviousItem:function(){this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(){this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&(value="checkbox"==e.target.type?e.target.checked?1:0:e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("soliloquy_save_meta",{context:this,data:{nonce:soliloquy_metabox_local.save_nonce,post_id:soliloquy_metabox_local.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var t=JSON.stringify(this.model.attributes),i=(jQuery("ul#soliloquy-output li#"+this.model.get("id")).attr("data-soliloquy-image-model",t),this.$el.find(".saved"));i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("soliloquy_get_attachment_links",{context:this,data:{nonce:soliloquy_metabox_local.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("soliloquy_get_attachment_links",{context:this,data:{nonce:soliloquy_metabox_local.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),SoliloquyChildViews=[],SoliloquyContentViews=[];function SoliloquySlidesUpdate(e){SoliloquySlides.reset(),jQuery("ul#soliloquy-output li.soliloquy-slide"+(e?".selected":"")).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-soliloquy-image-model"));SoliloquySlides.add(new SoliloquySlide(e))})}!function(t){t(document).ready(function(){(soliloquy_edit={init:function(){SoliloquySlidesUpdate(),t("#soliloquy-settings-content").on("click.soliloquyModify",".soliloquy-modify-slide",function(e){e.preventDefault();e=t(this).parent().data("soliloquy-slide");SoliloquyModalWindow.content(new SoliloquyView({collection:SoliloquySlides,child_views:SoliloquyChildViews,attachment_id:e})),SoliloquyModalWindow.open(),t(document).trigger("soliloquyEditOpen"),t(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})})}}).init()}),t(document).on("soliloquyUploaded",function(){soliloquy_edit.init()})}(jQuery),function(d,e,u){"use strict";var t={init:function(){this.select_all(),this.sortable(),this.select(),this.display(),this.chosen(),this.slide_size(),this.uploadImage(),this.toggleStatus(),this.tooltip(),this.clear_selected(),new Clipboard(".soliloquy-clipboard"),d("ul#soliloquy-output").on("click","a.check",function(e){e.preventDefault()}),d(".soliloquy-clipboard").on("click",function(e){e.preventDefault()});var e=d("#soliloquy-output li").length;d(".soliloquy-count").text(e.toString()),d("input,select").conditional()},toggleStatus:function(){d("#soliloquy-settings-content").on("click.soliloquyStatus",".soliloquy-slide-status",function(e){var t="",i="",e=(e.preventDefault(),t=(d(this).hasClass("list-status")?d(this).parent().parent():d(this)).parent(),d(this)),l=e.data("status"),o=t.find(".soliloquy-slide-status.list-status"),a=t.find(".soliloquy-slide-status.grid-status"),t=(e.parent().parent().data("view"),e.data("id")),s=a.find("span.dashicons"),n=o.find("span"),i=(e.data("soliloquy-tooltip"),"active"===l?"pending":"active"),e={url:u.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_change_slide_status",post_id:u.id,slide_id:t,status:i,nonce:u.save_nonce},success:function(e){"active"===i?(a.removeClass("soliloquy-draft-slide").addClass("soliloquy-active-slide"),o.removeClass("soliloquy-draft-slide").addClass("soliloquy-active-slide"),s.removeClass("dashicons-hidden").addClass("dashicons-visibility"),n.text(u.active),a.attr("data-soliloquy-tooltip",u.active),o.data("status","active"),a.data("status","active")):(a.removeClass("soliloquy-active-slide").addClass("soliloquy-draft-slide"),o.removeClass("soliloquy-active-slide").addClass("soliloquy-draft-slide"),s.removeClass("dashicons-visibility").addClass("dashicons-hidden"),n.text(u.draft),o.data("status","pending"),a.data("status","pending"),a.attr("data-soliloquy-tooltip",u.draft))},error:function(e,t,i){}};d.ajax(e)})},tooltip:function(){d("[data-soliloquy-tooltip]").on("mouseover",function(e){e.preventDefault();d(this).data("soliloquy-tooltip")})},select_all:function(){d(".soliloquy-select-all").change(function(){var e;this.checked?(d("ul#soliloquy-output li").addClass("selected"),d(".soliloquy-bulk-actions").fadeIn(),e=d("ul#soliloquy-output li.selected").length,d(".select-all").text(u.selected),d(".soliloquy-count").text(e.toString()),d(".soliloquy-clear-selected").fadeIn()):(d("ul#soliloquy-output li").removeClass("selected"),d(".soliloquy-bulk-actions").fadeOut(),e=d("ul#soliloquy-output li").length,d(".select-all").text(u.select_all),d(".soliloquy-count").text(e.toString()),d(".soliloquy-clear-selected").fadeOut())})},sortable:function(){var l=d("#soliloquy-output");l.sortable({containment:"#soliloquy-slider-main",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(e,t){var i={url:u.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_images",order:l.sortable("toArray").toString(),post_id:u.id,nonce:u.sort},success:function(e){SoliloquySlidesUpdate()},error:function(e,t,i){}};d.ajax(i)}})},select:function(){var s=!1,n=!1;d("li.soliloquy-slide .soliloquy-item-content, .soliloquy-list li a.check").on("click",function(e){d(this);var t,i=d(this).parent();if(e.preventDefault(),d(i).hasClass("selected"))d(i).removeClass("selected"),n=!1,0!==(t=d("ul#soliloquy-output li.selected").length)?(d(".select-all").text(u.selected),d(".soliloquy-count").text(t.toString()),d(".soliloquy-clear-selected").fadeIn()):(e=d("ul#soliloquy-output li").length,d(".select-all").text(u.select_all),d(".soliloquy-count").text(e.toString()),d(".soliloquy-clear-selected").fadeOut());else{if(s&&!1!==n){var l=d("ul#soliloquy-output li").index(d(n)),o=d("ul#soliloquy-output li").index(d(i)),a=0;if(l<o)for(a=l;a<=o;a++)d("ul#soliloquy-output li:eq( "+a+")").addClass("selected");else for(a=o;a<=l;a++)d("ul#soliloquy-output li:eq( "+a+")").addClass("selected")}d(i).addClass("selected"),n=d(i),t=d("ul#soliloquy-output li.selected").length,d(".soliloquy-clear-selected").fadeIn(),d(".select-all").text(u.selected),d(".soliloquy-count").text(t.toString())}0<d("ul#soliloquy-output > li.selected").length?d(".soliloquy-bulk-actions").fadeIn():d(".soliloquy-bulk-actions").fadeOut()}),d(e).on("keyup keydown",function(e){s=e.shiftKey})},slide_size:function(){d(e).on("change","#soliloquy-config-slider-size",function(){var e=d(this),t=e.val(),i=e.find(":selected").data("soliloquy-width"),e=e.find(":selected").data("soliloquy-height");"default"==t&&(d("#soliloquy-config-slider-width").val(u.slide_width),d("#soliloquy-config-slider-height").val(u.slide_height)),i&&d("#soliloquy-config-slider-width").val(i),e&&d("#soliloquy-config-slider-height").val(e)})},clear_selected:function(){d(".soliloquy-clear-selected").on("click",function(e){e.preventDefault();e=d("#soliloquy-output li").length;d("ul#soliloquy-output li").removeClass("selected"),d(".select-all").text(u.select_all),d(".soliloquy-count").text(e.toString()),d(".soliloquy-select-all").prop("checked",!1),d(".soliloquy-bulk-actions").fadeOut(),d(this).fadeOut()})},display:function(){d("a.soliloquy-display").on("click",function(e){var t,i,l;e.preventDefault(),d(this).hasClass("active-display")||(t=(e=d(this)).data("soliloquy-display"),i=d("#soliloquy-output"),l={url:u.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_slider_view",post_id:u.id,view:t,nonce:u.save_nonce},success:function(e){}},d.ajax(l),d(".soliloquy-display-toggle").find(".active-display").removeClass("active-display"),e.addClass("active-display"),"grid"===t?i.removeClass("soliloquy-list").addClass("soliloquy-grid"):"list"===t&&i.removeClass("soliloquy-grid").addClass("soliloquy-list"))})},chosen:function(){d(".soliloquy-chosen").each(function(){var e=d(this).data("soliloquy-chosen-options");d(this).chosen(e)})},uploadImage:function(){d(".soliloquy-insert-image").on("click",function(e){var t;e.preventDefault();var i=d(event.currentTarget).parent().find("input");t||(t=wp.media.frames.soliloquy_image_frame=wp.media({frame:"select",library:{type:"image"},title:u.insert_image,button:{text:u.insert_image},contentUserSetting:!1,multiple:!1})).on("select",function(){var e=t.state().get("selection").first().toJSON();i.val(e.url)}),t.open()})}};d(function(){t.init()}),d(e).on("soliloquyType",function(){t.init()})}(jQuery,(window,document),soliloquy_metabox_local),function(a,s,n){a(function(){var i,l,o;"undefined"!=typeof uploader&&(a("input#plupload-browse-button").val(n.uploader_files_computer),a(".drag-drop-info").text(n.uploader_info_text),a("#soliloquy .drag-drop-inside").append('<div class="soliloquy-progress-bar"><div></div></div>'),i=a("#soliloquy .soliloquy-progress-bar"),l=a("#soliloquy .soliloquy-progress-bar div"),o=a("#soliloquy-output"),uploader.bind("FilesAdded",function(e,t){e.files=t,a(i).fadeIn()}),uploader.bind("BeforeUpload",function(e,t){if(t.name.toLowerCase().endsWith(".heic")&&!n.is_imagick_enabled)return a("#soliloquy-upload-error").html(`<div class="error fade"><p>${n.heic_error_text}</p></div>`),!1}),uploader.bind("UploadProgress",function(e,t){a(l).css({width:e.total.percent+"%"})}),uploader.bind("FileUploaded",function(e,t,i){a.post(n.ajax,{action:"soliloquy_load_image",nonce:n.load_image,id:i.response,post_id:n.id},function(e){"before"===n.media_position?a(o).prepend(e):a(o).append(e),a(s).trigger("soliloquyUploaded"),a(e).find(".wp-editor-container").each(function(e,t){t=a(t).attr("id").split("-")[4];quicktags({id:"soliloquy-caption-"+t,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()});const t=a("#soliloquy-output li").length;a(".soliloquy-count").text(t.toString()),0<t&&(a("#soliloquy-empty-slider").fadeOut().addClass("soliloquy-hidden"),a(".soliloquy-slide-header").removeClass("soliloquy-hidden").fadeIn())},"json")}),uploader.bind("UploadComplete",function(){a(i).fadeOut()}),uploader.bind("Error",function(e,t){a("#soliloquy-upload-error").html('<div class="error fade"><p>'+t.file.name+": "+t.message+"</p></div>"),e.refresh()}))})}(jQuery,(window,document),soliloquy_media_uploader),function(s,n){"use strict";var e,t,i,l=n.location.hash,o=n.location.hash.replace("!","");l&&0<=l.indexOf("soliloquy-tab")&&(e=(l=s(o.replace("tab_",""))).parent(),t=l.parent().parent().find("ul.soliloquy-tabs-nav"),i=s("#post").attr("action"),e.find(".soliloquy-tab-active").removeClass("soliloquy-tab-active"),l.addClass("soliloquy-tab-active"),t.find(".soliloquy-tab-nav-active").removeClass("soliloquy-tab-nav-active"),t.find('a[href="'+o.replace("tab_","")+'"]').parent().addClass("soliloquy-tab-nav-active"),i&&(i=i.split("#")[0],s("#post").attr("action",i+n.location.hash)),s("body").trigger("SoliloquyTabChange")),s(function(){s("[data-soliloquy-tab]").on("click",function(e){e.preventDefault();var e=s(this),t=e.attr("data-tab-id"),i=e.parent(),l=i.parent(),o=i.attr("data-update-hashbang"),a=void 0!==e.attr("href")?"tab_"+e.attr("href"):"tab_"+t;if(!e.hasClass("soliloquy-tab-nav-active"))return l.find(".soliloquy-tab-active").removeClass("soliloquy-tab-active"),i.find(".soliloquy-tab-nav-active").removeClass("soliloquy-tab-nav-active"),e.addClass("soliloquy-tab-nav-active"),s("#"+t).addClass("soliloquy-tab-active"),e.trigger("SoliloquyTabChange"),"soliloquy-native"===t&&!0!==s("#soliloquy-type-default").prop("checked")&&(s("#soliloquy-types-nav li").removeClass("soliloquy-active"),s("#soliloquy-type-default").prop("checked",!0).trigger("change")),"1"===o&&(n.location.hash=a.split("#").join("#!"),(l=s("#post").attr("action"))&&(l=l.split("#")[0],s("#post").attr("action",l+n.location.hash))),!1})})}(jQuery,window,document);